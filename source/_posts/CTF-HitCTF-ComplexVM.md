---
title: CTF HitCTF ComplexVM
date: 2025-12-17 19:46:24
tags: CTF
categories: CTF
---
## 前言
我觉得这道题挺适合作为vm入门的，尝试一下脑海中的方法
## 第一部分，乱序比较
虚拟机首先要知道输入的东西在哪，我们随便输入一些完全不会重复的东西试试  
比如我输入的  
```
why_vm_so_hard  
```
转换成十六进制  
```
77 68 79 5f 76 6d 5f 73 6f 5f 68 61 72 64  
```
在输入之后下断点，alt+b搜索，能搜到  
然后跟踪几次，发现虚拟机进入了一个函数case 31，它读取了输入缓冲区  
相比肯定是虚拟机的Input指令，留意一下case 31  
第一个读取的是y  
有意思，我们跟踪一下  
我们发现，它和一个常量r8b比较了一下  
```
.text:00007FF633EA4050 movzx   eax, dl
.text:00007FF633EA4053 movzx   edx, byte ptr [rax+rcx+8]
.text:00007FF633EA4058 movzx   eax, r8b
.text:00007FF633EA405C sub     edx, eax
.text:00007FF633EA405E test    dl, dl
.text:00007FF633EA4060 jnz     short loc_7FF633EA4068
```
可以猜测，这里其实是虚拟机的cmp指令，我们下一下断点，重新开始  
通过这个方法，我们可以得到  
```
f l a g { H I T C T F  2  0  2  5  _  2  8  7
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
```
## 第二部分，反向推导
接下来就是比较复杂的部分了  
随后我们跟踪一下第十九个字符  
断点case31，跟踪输入的字符，发现它和'7'异或了一次再和'R'比较那么反向推导，就可以出来，原字符是e  
同样的，之后的慢慢追，慢慢写，你就可以得到答案  
```
flag{HITCTF2025_287ec47c}
```  
## 痛点分析
1. 这道题使用的是流式比较，每一次获取原字符的时候都会进行判断，导致需要不断的重试  
但是这个也提供了我们用这种方法解题的可能  
2. 这道题很多地方源码级调试是不够的，必须要汇编级调试
3. 对于新手需要一些耐心  
   ~~比赛的时候看到线索的时候就不缺耐心了~~
## 爽点/小白知识点
这是对于我这种对VM一窍不通的人而言的
1. 了解如何上手一个VM(流式加密/验证)
   - 追踪输入数据和处理
   - 获取处理方法
   - 得到答案
2. 了解虚拟机常用结构体，实现方式和基本结构：
   - switch-case实现指令集
   - 寄存器模拟
   - 内存模拟
   - 指令实现方式